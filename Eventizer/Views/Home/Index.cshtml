@{
    ViewBag.Title = "Index";
}

<div class="container index">
    <div class="row">
        <div class="col-md-offset-8 col-md-4 login-box">
            <div class="alert-wrap">
                <div class="alert alert-danger">
                    <strong>Geez.</strong> Wrong Email/Password.
                </div>
                <div class="alert alert-success">
                    Redirecting you to your dashboard.
                </div>
                <div class="alert alert-warning">
                    <strong>Something went wrong.</strong> Try again later.
                </div>
            </div>
            <form role="form" id="login-form">
                <div class="form-group">
                    <label for="email">Email address</label>
                    <input type="email" class="form-control" name="email" id="email" placeholder="Enter email">
                </div>
                <div class="form-group">

                    <label for="password">Password</label>
                    <input type="password" class="form-control" name="password" id="password" placeholder="Password">
                </div>

                <button type="submit" class="btn btn-primary">Submit</button>
                <a href="/Register" class="btn btn-default">Register</a>
            </form>
        </div>
    </div>
</div>
<script>

    $(document).ready(function () {
        var request;
        $('#login-form').submit(function (e) {

            if (request) {
                request.abort();
            }
            var $form = $(this);
            var $inputs = $form.find("input, select, button, textarea");
            var serializedData = $form.serialize();

            $inputs.prop("disabled", true);

            console.log(serializedData);

            request = $.ajax({
                url: "@Url.Action("Login", "Ajax")",
                type: "post",
                data: serializedData
            });

            request.done(function (response, textStatus, jqXHR) {
                $('.alert').hide();

                console.log(response);
                if (response == 0) {
                    $('.alert-danger').stop().fadeIn();
                }
                else if (response == 1) {
                    $('.alert-success').stop().fadeIn();
                    setTimeout(function () { window.location = '/Dashboard'; }, 1000);
                }
                else {
                    $('.alert-warning').stop().fadeIn();
                }
            });

            request.fail(function (jqXHR, textStatus, errorThrown) {
                console.error(
                    "The following error occured: " +
                        textStatus, errorThrown
                );
            });

            request.always(function () {
                $inputs.prop("disabled", false);
            });

            e.preventDefault();
        });
    });

    showAlert = function (heading, text) {
        var modalMarkup = '<div class="modal fade" id="modal-alert"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">' + heading + '</h4></div><div class="modal-body"><p>' + text + '</p></div></div></div></div>';

        $('body').append(modalMarkup);
        $('#modal-alert').modal();

    };

</script>
